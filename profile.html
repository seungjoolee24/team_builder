<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Profile - Sogang Team Building</title>

    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Outfit:wght@500;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="./css/style.css">
    <style>
        /* Extra Helper for specific layouts */
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }

        @media (max-width: 600px) {
            .grid-2 {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>

    <header id="main-header"></header>

    <main class="container" style="padding: 3rem 1rem;">

        <div style="display: grid; grid-template-columns: 280px 1fr; gap: 2rem; align-items: start;">

            <!-- Sidebar -->
            <div class="card" style="text-align: center; padding: 2rem; position: sticky; top: 6rem;">
                <div
                    style="width: 120px; height: 120px; margin: 0 auto 1.5rem; background: #f0f0f0; border-radius: 50%; overflow: hidden; border: 4px solid white; box-shadow: var(--shadow-md);">
                    <img id="profile-avatar" src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" alt="Profile"
                        style="width: 100%; height: 100%;">
                </div>
                <h2 id="display-name" style="font-size: 1.5rem; margin-bottom: 0.25rem;">Student Name</h2>
                <p id="display-major" style="color: var(--color-text-secondary); margin-bottom: 1.5rem;">Major Undefined
                </p>

                <div
                    style="text-align: left; margin-top: 1.5rem; border-top: 1px solid var(--color-border); padding-top: 1.5rem;">
                    <div style="margin-bottom: 0.75rem;">
                        <span
                            style="font-size: 0.85rem; color: var(--color-text-secondary); display: block;">Email</span>
                        <span id="display-email" style="font-weight: 500;">student@sogang.ac.kr</span>
                    </div>
                </div>
            </div>

            <!-- Main Content: Profile Form -->
            <div>
                <div
                    style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; padding: 0 0.5rem;">
                    <div>
                        <h2 style="font-size: 1.8rem;">Profile Settings</h2>
                        <p style="color: var(--color-text-secondary); font-size: 0.95rem;">Build your identity to find
                            the perfect team.</p>
                    </div>
                    <button id="save-btn" class="btn btn-primary" style="padding-left: 2rem; padding-right: 2rem;">Save
                        Changes</button>
                </div>

                <form id="profile-form">

                    <!-- 1. Academic & Bio (Required) -->
                    <div class="accordion active">
                        <div class="accordion-header">
                            <h3>Academic & Basic Info <span class="section-tag required">Required</span></h3>
                            <span class="accordion-icon">▼</span>
                        </div>
                        <div class="accordion-content">
                            <div class="grid-2">
                                <div class="input-group">
                                    <label class="label">College</label>
                                    <select id="college" class="input">
                                        <option value="">Select College</option>
                                        <option value="Humanities">Humanities</option>
                                        <option value="Social Sciences">Social Sciences</option>
                                        <option value="Natural Sciences">Natural Sciences</option>
                                        <option value="Engineering">Engineering</option>
                                        <option value="Economics">Economics</option>
                                        <option value="Business Administration">Business Administration</option>
                                        <option value="Integrated Knowledge">Integrated Knowledge (Media/Art)</option>
                                        <option value="AI/Graduate">AI/Convergence</option>
                                    </select>
                                </div>
                                <div class="input-group">
                                    <label class="label">Major</label>
                                    <select id="major" class="input">
                                        <option value="">Select Major</option>
                                    </select>
                                </div>
                            </div>
                            <div class="input-group">
                                <label class="label">Bio / Introduction</label>
                                <textarea id="bio" class="input" rows="3"
                                    placeholder="Briefly introduce yourself..."></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- 2. Roles & Skills (Required) -->
                    <div class="accordion active">
                        <div class="accordion-header">
                            <h3>Roles & Skills <span class="section-tag required">Required</span></h3>
                            <span class="accordion-icon">▼</span>
                        </div>
                        <div class="accordion-content">
                            <div class="input-group">
                                <label class="label">Primary Role</label>
                                <select id="primaryRole" class="input" required>
                                    <option value="">Choose your main strength</option>
                                    <option value="planner">Planner (PM)</option>
                                    <option value="designer">Designer (UI/UX)</option>
                                    <option value="frontend">Frontend Developer</option>
                                    <option value="backend">Backend Developer</option>
                                    <option value="data">Data/AI Engineer</option>
                                    <option value="mobile">Mobile Developer</option>
                                    <option value="devops">DevOps/Infra</option>
                                    <option value="game">Game Developer</option>
                                    <option value="marketing">Marketing/Business</option>
                                    <option value="media">Media/Video Artist</option>
                                </select>
                            </div>

                            <div class="input-group">
                                <label class="label">Other Roles (Optional)</label>
                                <div class="checkbox-group" id="otherRoles-group">
                                    <label class="checkbox-item"><input type="checkbox" value="planner"> PM</label>
                                    <label class="checkbox-item"><input type="checkbox" value="designer">
                                        Designer</label>
                                    <label class="checkbox-item"><input type="checkbox" value="frontend">
                                        Frontend</label>
                                    <label class="checkbox-item"><input type="checkbox" value="backend"> Backend</label>
                                    <label class="checkbox-item"><input type="checkbox" value="mobile"> Mobile</label>
                                    <label class="checkbox-item"><input type="checkbox" value="devops"> DevOps</label>
                                    <label class="checkbox-item"><input type="checkbox" value="data"> AI/Data</label>
                                    <label class="checkbox-item"><input type="checkbox" value="game"> Game Dev</label>
                                    <label class="checkbox-item"><input type="checkbox" value="marketing">
                                        Marketing</label>
                                    <label class="checkbox-item"><input type="checkbox" value="media"> Media/Art</label>
                                </div>
                            </div>

                            <div class="input-group" style="margin-top: 2rem;">
                                <label class="label">Skills Registry</label>
                                <p style="font-size: 0.85rem; color: var(--color-text-tertiary); margin-bottom: 1rem;">
                                    Select your skills to define your proficiency.</p>

                                <div id="skills-list">
                                    <!-- Dynamic entry rows will go here -->
                                </div>

                                <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
                                    <select id="skill-category-add" class="input" style="flex: 1;">
                                        <option value="Programming">Programming</option>
                                        <option value="Frameworks">Frameworks</option>
                                        <option value="Infrastructure">Infrastructure</option>
                                        <option value="Design">Design</option>
                                        <option value="Other">Other</option>
                                    </select>
                                    <input type="text" id="skill-name-add" class="input" style="flex: 1.5;"
                                        placeholder="Skill Name (e.g. React)" list="skill-name-options">
                                    <datalist id="skill-name-options">
                                        <!-- Populated dynamically based on category -->
                                    </datalist>

                                    <select id="skill-level-add" class="input" style="flex: 1;">
                                        <option value="beginner">Beginner</option>
                                        <option value="intermediate">Intermediate</option>
                                        <option value="advanced">Advanced</option>
                                    </select>
                                    <button type="button" id="add-skill-btn" class="btn btn-secondary">Add</button>
                                </div>
                                <div id="skill-suggestions"
                                    style="margin-top: 0.5rem; display: flex; flex-wrap: wrap; gap: 0.4rem;">
                                    <!-- Suggestions based on category -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 3. Links (Optional) -->
                    <div class="accordion">
                        <div class="accordion-header">
                            <h3>Links <span class="section-tag optional">Optional</span></h3>
                            <span class="accordion-icon">▼</span>
                        </div>
                        <div class="accordion-content">
                            <div class="grid-2">
                                <div class="input-group">
                                    <label class="label">GitHub</label>
                                    <input type="text" id="link-github" class="input"
                                        placeholder="https://github.com/...">
                                </div>
                                <div class="input-group">
                                    <label class="label">Portfolio</label>
                                    <input type="text" id="link-portfolio" class="input"
                                        placeholder="Personal website link">
                                </div>
                                <div class="input-group">
                                    <label class="label">YouTube</label>
                                    <input type="text" id="link-youtube" class="input"
                                        placeholder="YouTube channel link">
                                </div>
                                <div class="input-group">
                                    <label class="label">Instagram</label>
                                    <input type="text" id="link-instagram" class="input" placeholder="@handle or link">
                                </div>
                            </div>

                            <!-- Custom Links -->
                            <div class="input-group"
                                style="margin-top: 1.5rem; border-top: 1px solid var(--color-border); padding-top: 1.5rem;">
                                <label class="label">Custom Links</label>
                                <div id="custom-links-container"
                                    style="display: flex; flex-direction: column; gap: 0.75rem; margin-bottom: 1rem;">
                                    <!-- Dynamic links injected here -->
                                </div>

                                <div style="display: flex; gap: 0.5rem;">
                                    <input type="text" id="custom-link-label" class="input" style="flex: 1;"
                                        placeholder="Label (e.g. Notion)">
                                    <input type="text" id="custom-link-url" class="input" style="flex: 2;"
                                        placeholder="URL (https://...)">
                                    <button type="button" id="add-link-btn" class="btn btn-secondary">Add</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 4. Detailed Tags (Unified System) -->
                    <div class="accordion active">
                        <div class="accordion-header">
                            <h3>Detailed Profile Tags <span class="section-tag required">Recommended</span></h3>
                            <span class="accordion-icon">▼</span>
                        </div>
                        <div class="accordion-content">
                            <p style="color: var(--color-text-secondary); margin-bottom: 1.5rem; font-size: 0.9rem;">
                                Select tags that describe your interests, work style, and goals. These tags are used to
                                recommend you to teammates.
                            </p>

                            <!-- Selected Tags Display -->
                            <div style="margin-bottom: 2rem;">
                                <label class="label">My Tags</label>
                                <div id="my-tags-container" class="chips-container"
                                    style="min-height: 40px; padding: 0.5rem; background: #f8f9fa; border: 1px solid var(--color-border); border-radius: 8px;">
                                    <!-- Selected tags go here -->
                                </div>
                                <input type="text" id="manual-tag-input" class="input" style="margin-top: 0.5rem;"
                                    placeholder="Type custom tag and press Enter...">
                            </div>

                            <!-- Predefined Categories -->
                            <div id="predefined-tags-area">
                                <!-- Injected via JS -->
                            </div>
                        </div>
                    </div>

                </form>
            </div>
        </div>
    </main>

    <footer id="main-footer"></footer>

    <script src="./js/app.js"></script>
    <script>
        const PREDEFINED_TAG_CATEGORIES = {
            'Interest': [
                'Web/App', 'AI/Data', 'Fintech', 'Game Dev', 'Blockchain', 'E-commerce',
                'IoT', 'Metaverse', 'Cloud Computing', 'Security', 'Healthcare', 'EdTech',
                'Social Media', 'Enterprise', 'SaaS', 'Mobile'
            ],
            'Preference': [
                'Competition', 'Side Project', 'Startup', 'Study Group', 'Hackathon',
                'Capstone', 'Research', 'Volunteering', 'Freelance'
            ],
            'Collaboration': [
                'Less than 5h/week', '5-10h/week', '10-20h/week', '20h+/week',
                'Online Only', 'Offline Preferred', 'Hybrid', 'Flexible Hours',
                'Fixed Schedule', 'Weekends Only', 'Weekdays Only',
                'Short-term (1mo)', 'Mid-term (3mo)', 'Long-term (6mo+)'
            ],
            'Availability': [
                'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday',
                'Saturday', 'Sunday', 'Morning', 'Afternoon', 'Evening', 'Late Night'
            ],
            'Goals': [
                'Win Awards', 'Build Portfolio', 'Networking', 'Learn New Tech',
                'Launch Product', 'Get Hired', 'Have Fun', 'Solve Real Problem'
            ],
            'Motivation': [
                'High Passion', 'Serious & Committed', 'Just Experience',
                'Chill / Casual', 'Growth Mindset', 'Leadership', 'Team Player'
            ],
            'Deep Tech': [
                'Blockchain', 'NFT', 'Metaverse', 'IoT', 'Cloud', 'Cybersecurity', 'Robotics'
            ],
            'Lifestyle': [
                'Health/Sport', 'Travel', 'Environment (ESG)', 'Social Impact', 'Fashion/Beauty', 'Food/Gourmet'
            ],
            'Work Style': [
                'Agile', 'Remote Work', 'MVP Focus', 'TDD', 'Pair Programming', 'Async Comm'
            ]
        };

        const SKILL_SUGGESTIONS = {
            'Programming': ['JavaScript', 'TypeScript', 'Python', 'Java', 'C++', 'C', 'C#', 'Go', 'Rust', 'Swift', 'Kotlin', 'Dart', 'PHP', 'Ruby', 'SQL', 'HTML/CSS', 'Shell', 'R', 'MATLAB', 'Solidity'],
            'Frameworks': ['React', 'Vue.js', 'Next.js', 'Angular', 'Svelte', 'Node.js', 'Django', 'Spring Boot', 'Flutter', 'React Native', 'Express', 'FastAPI', 'Flask', 'Laravel', 'Ruby on Rails', 'TensorFlow', 'PyTorch', 'Unity', 'Unreal Engine'],
            'Infrastructure': ['Docker', 'Kubernetes', 'AWS', 'GCP', 'Azure', 'Firebase', 'Vercel', 'Netlify', 'GitHub Actions', 'Jenkins', 'Terraform', 'Nginx', 'Linux'],
            'Design': ['Figma', 'Adobe XD', 'Photoshop', 'Illustrator', 'After Effects', 'Premiere Pro', 'Blender', 'Cinema4D', 'Zeplin', 'ProtoPie', 'Sketch', 'InDesign'],
            'Other': ['Git', 'Jira', 'Notion', 'Slack', 'Excel', 'Google Analytics', 'SEO', 'Tableau', 'Power BI']
        };

        const SOGANG_ACADEMIC_DATA = {
            'Humanities': ['Korean Language and Literature', 'English Language and Literature', 'German Language and Literature', 'French Language and Literature', 'Chinese Language and Literature', 'Philosophy', 'History', 'Religious Studies'],
            'Social Sciences': ['Sociology', 'Political Science', 'Psychology', 'Social Welfare'],
            'Economics': ['Economics'],
            'Business Administration': ['Business Administration'],
            'Natural Sciences': ['Mathematics', 'Physics', 'Chemistry', 'Life Science'],
            'Engineering': ['Electronic Engineering', 'Computer Science and Engineering', 'Chemical and Biomolecular Engineering', 'Mechanical Engineering'],
            'Integrated Knowledge': ['Journalism and Strategic Communication', 'Media & Entertainment', 'Art & Technology', 'Global Korean Studies'],
            'AI/Graduate': ['AI', 'Convergence Software']
        };

        function setupAcademicSystem() {
            const collegeSelect = document.getElementById('college');
            const majorSelect = document.getElementById('major');

            collegeSelect.addEventListener('change', () => {
                const majors = SOGANG_ACADEMIC_DATA[collegeSelect.value] || [];
                majorSelect.innerHTML = '<option value="">Select Major</option>' +
                    majors.map(m => `<option value="${m}">${m}</option>`).join('');
            });
        }

        const state = {
            skills: [],
            tags: new Set(),
            customLinks: []
        };

        document.addEventListener('DOMContentLoaded', async () => {
            // 1. Load User Info (Name, Email)
            const user = window.db.getCurrentUser();
            if (user) {
                document.getElementById('display-name').textContent = user.name;
                document.getElementById('display-email').textContent = user.email;
                document.getElementById('profile-avatar').src = `https://api.dicebear.com/7.x/avataaars/svg?seed=${user.name}`;
            }

            // 2. Initialize UI Systems
            setupAccordions();
            setupAcademicSystem();
            setupSkillSystem();
            setupLinkSystem();
            setupTagSystem();

            // 3. Load Profile Data
            const profileData = await window.db.getProfile();
            if (profileData) {
                fillFormData(profileData);
            }

            // 4. Save Handler
            document.getElementById('save-btn').addEventListener('click', async (e) => {
                e.preventDefault();
                const formData = collectFormData();
                const result = await window.db.updateProfile(formData);
                if (result.success) {
                    alert('Profile saved successfully!');
                    window.location.reload();
                } else {
                    alert('Failed to save: ' + result.message);
                }
            });
        });



        function setupAccordions() {
            document.querySelectorAll('.accordion-header').forEach(header => {
                header.addEventListener('click', () => {
                    const accordion = header.parentElement;
                    accordion.classList.toggle('active');
                });
            });
        }

        function setupSkillSystem() {
            const addBtn = document.getElementById('add-skill-btn');
            const nameInput = document.getElementById('skill-name-add');
            const categorySelect = document.getElementById('skill-category-add');
            const dataList = document.getElementById('skill-name-options');

            // Function to update datalist options
            const updateSuggestions = () => {
                const category = categorySelect.value;
                const suggestions = SKILL_SUGGESTIONS[category] || [];
                dataList.innerHTML = suggestions.map(skill => `<option value="${skill}">`).join('');
            };

            // Initialize and listen for changes
            updateSuggestions();
            categorySelect.addEventListener('change', () => {
                nameInput.value = ''; // Clear input on category change
                updateSuggestions();
            });

            addBtn.addEventListener('click', () => {
                const name = nameInput.value.trim();
                const category = categorySelect.value;
                const level = document.getElementById('skill-level-add').value;
                if (!name) return;

                addSkillToUI({ name, category, level });
                nameInput.value = '';
            });

            window.removeSkill = (index) => {
                state.skills.splice(index, 1);
                renderSkills();
            };
        }

        function addSkillToUI(skill) {
            // Avoid duplicates
            if (state.skills.some(s => s.name.toLowerCase() === skill.name.toLowerCase())) return;
            state.skills.push(skill);
            renderSkills();
        }

        function renderSkills() {
            const container = document.getElementById('skills-list');
            container.innerHTML = state.skills.map((skill, index) => {
                const levelColor = skill.level === 'advanced' ? 'var(--color-sogang-red)' : skill.level === 'intermediate' ? 'var(--color-primary)' : 'var(--color-text-secondary)';
                return `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; background: var(--color-bg-secondary); border-radius: 6px; margin-bottom: 0.5rem;">
                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                            <span style="font-weight: 600; font-size: 0.9rem;">${skill.name}</span>
                            <span class="badge" style="font-size: 0.7rem; background: white; border: 1px solid ${levelColor}; color: ${levelColor}; text-transform: capitalize;">${skill.level || 'beginner'}</span>
                            <span style="font-size: 0.8rem; color: var(--color-text-tertiary);">${skill.category}</span>
                        </div>
                        <button type="button" onclick="removeSkill(${index})" style="color: var(--color-text-tertiary); background: none; border: none; font-size: 1.25rem; cursor: pointer;">&times;</button>
                    </div>
                `;
            }).join('');
        }

        function setupLinkSystem() {
            const addBtn = document.getElementById('add-link-btn');
            const labelInput = document.getElementById('custom-link-label');
            const urlInput = document.getElementById('custom-link-url');

            addBtn.addEventListener('click', () => {
                const label = labelInput.value.trim();
                const url = urlInput.value.trim();

                if (!label || !url) return alert('Please enter both label and URL');

                addLinkToUI({ label, url });
                labelInput.value = '';
                urlInput.value = '';
            });

            window.removeLink = (index) => {
                state.customLinks.splice(index, 1);
                renderCustomLinks();
            };
        }

        function addLinkToUI(link) {
            state.customLinks.push(link);
            renderCustomLinks();
        }

        function renderCustomLinks() {
            const container = document.getElementById('custom-links-container');
            container.innerHTML = state.customLinks.map((link, index) => `
                <div style="display: flex; gap: 0.5rem; align-items: center; background: var(--color-bg-secondary); padding: 0.5rem; border-radius: 4px;">
                    <span style="font-weight: 600; font-size: 0.9rem; min-width: 80px;">${link.label}</span>
                    <a href="${link.url}" target="_blank" style="flex: 1; font-size: 0.85rem; color: var(--color-primary); overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${link.url}</a>
                    <button type="button" onclick="removeLink(${index})" style="background: none; border: none; cursor: pointer; font-size: 1.2rem; color: var(--color-text-tertiary);">&times;</button>
                </div>
            `).join('');
        }

        // ... setupTagSystem ...
        function setupTagSystem() {
            const container = document.getElementById('predefined-tags-area');
            const myTagsContainer = document.getElementById('my-tags-container');
            const input = document.getElementById('manual-tag-input');

            // Render Predefined Categories
            Object.entries(PREDEFINED_TAG_CATEGORIES).forEach(([category, tags]) => {
                const group = document.createElement('div');
                group.style.marginBottom = '1.5rem';
                group.innerHTML = `<h4 style="font-size:0.9rem; margin-bottom:0.5rem; color:var(--color-text-secondary);">${category}</h4>`;

                const chipsDiv = document.createElement('div');
                chipsDiv.style.display = 'flex';
                chipsDiv.style.flexWrap = 'wrap';
                chipsDiv.style.gap = '0.5rem';

                tags.forEach(tag => {
                    const chip = document.createElement('span');
                    chip.className = 'badge'; // Reuse badge style
                    chip.style.cursor = 'pointer';
                    chip.style.background = 'white';
                    chip.style.border = '1px solid var(--color-border)';
                    chip.style.color = 'var(--color-text-primary)';
                    chip.textContent = tag;
                    chip.onclick = () => addTag(tag);
                    chipsDiv.appendChild(chip);
                });

                group.appendChild(chipsDiv);
                container.appendChild(group);
            });

            // Manual Input
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    addTag(input.value.trim());
                    input.value = '';
                }
            });
        }

        function addTag(tag) {
            if (!tag) return;
            if (state.tags.has(tag)) return;

            state.tags.add(tag);
            renderMyTags();
        }

        function removeTag(tag) {
            state.tags.delete(tag);
            renderMyTags();
        }

        function renderMyTags() {
            const container = document.getElementById('my-tags-container');
            container.innerHTML = '';
            state.tags.forEach(tag => {
                const chip = document.createElement('div');
                chip.className = 'chip';
                chip.style.background = 'var(--color-bg-tertiary)';
                chip.innerHTML = `<span>${tag}</span><span class="remove-chip" style="cursor:pointer; margin-left:0.5rem;" onclick="removeTag('${tag}')">&times;</span>`;
                container.appendChild(chip);
            });
        }

        function collectFormData() {
            // ... existing skills ...
            const getChecked = (selector) => Array.from(document.querySelectorAll(`${selector} input:checked`)).map(i => i.value);

            return {
                college: document.getElementById('college').value,
                major: document.getElementById('major').value,
                bio: document.getElementById('bio').value,
                primaryRole: document.getElementById('primaryRole').value,
                otherRoles: getChecked('#otherRoles-group'),
                skills: state.skills,
                links: {
                    github: document.getElementById('link-github').value,
                    portfolio: document.getElementById('link-portfolio').value,
                    youtube: document.getElementById('link-youtube').value,
                    instagram: document.getElementById('link-instagram').value
                },
                customLinks: state.customLinks, // Send custom links
                tags: Array.from(state.tags)
            };
        }

        function fillFormData(p) {
            // ... basics ...
            if (p.college) {
                document.getElementById('college').value = p.college;
                // Trigger major updates
                const majors = SOGANG_ACADEMIC_DATA[p.college] || [];
                document.getElementById('major').innerHTML = '<option value="">Select Major</option>' +
                    majors.map(m => `<option value="${m}">${m}</option>`).join('');
            }
            if (p.major) {
                document.getElementById('major').value = p.major;
                const displayMajor = document.getElementById('display-major');
                if (displayMajor) displayMajor.textContent = p.major;
            }
            if (p.bio) document.getElementById('bio').value = p.bio;
            if (p.primaryRole) document.getElementById('primaryRole').value = p.primaryRole;

            // ... checkboxes logic ...
            if (p.otherRoles) {
                p.otherRoles.forEach(val => {
                    const cb = document.querySelector(`#otherRoles-group input[value="${val}"]`);
                    if (cb) cb.checked = true;
                });
            }

            // Skills
            if (p.skills && Array.isArray(p.skills)) {
                p.skills.forEach(s => addSkillToUI(s));
            }

            // Links
            if (p.links) {
                document.getElementById('link-github').value = p.links.github || '';
                document.getElementById('link-portfolio').value = p.links.portfolio || '';
                document.getElementById('link-youtube').value = p.links.youtube || '';
                document.getElementById('link-instagram').value = p.links.instagram || '';
            }

            // Custom Links
            if (p.customLinks && Array.isArray(p.customLinks)) {
                p.customLinks.forEach(l => addLinkToUI(l));
            }

            // Tags
            if (p.tags && Array.isArray(p.tags)) {
                p.tags.forEach(t => state.tags.add(t));
                renderMyTags();
            }
        }

        function showSuccessFeedback() {
            const btn = document.getElementById('save-btn');
            const originalText = btn.textContent;
            btn.textContent = 'Saved!';
            btn.style.backgroundColor = 'var(--color-accent-teal)';
            setTimeout(() => {
                btn.textContent = originalText;
                btn.style.backgroundColor = '';
            }, 2000);
        }
    </script>
</body>

</html>