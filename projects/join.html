<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Find Projects - Sogang Team Building</title>

    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Outfit:wght@500;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="../css/style.css">
    <style>
        .filter-sidebar {
            width: 260px;
            flex-shrink: 0;
        }

        .projects-grid {
            flex-grow: 1;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .tab-btn {
            background: none;
            border: none;
            padding: 1rem 1.5rem;
            font-size: 1rem;
            font-weight: 500;
            color: var(--color-text-secondary);
            border-bottom: 2px solid transparent;
        }

        .tab-btn.active {
            color: var(--color-sogang-red);
            border-bottom-color: var(--color-sogang-red);
            font-weight: 600;
        }

        .filter-group {
            margin-bottom: 1.5rem;
        }

        .filter-group h4 {
            font-size: 0.9rem;
            margin-bottom: 0.75rem;
            color: var(--color-text-primary);
        }
    </style>
</head>

<body>

    <header id="main-header"></header>

    <main class="container" style="padding: 2rem 1rem;">

        <div style="display: flex; gap: 3rem; align-items: start;">

            <!-- Filters -->
            <aside class="filter-sidebar">
                <div class="card" style="padding: 1.5rem;">

                    <!-- Recommended Toggle -->
                    <div
                        style="margin-bottom: 2rem; padding-bottom: 1.5rem; border-bottom: 1px solid var(--color-border); display: flex; align-items: center; justify-content: space-between;">
                        <span style="font-weight: 600; font-size: 0.95rem;">Recommended Sorting</span>
                        <label class="switch"
                            style="position: relative; display: inline-block; width: 40px; height: 22px;">
                            <input type="checkbox" id="sort-toggle" checked>
                            <span class="slider round"
                                style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 22px;"></span>
                            <style>
                                .switch input {
                                    opacity: 0;
                                    width: 0;
                                    height: 0;
                                }

                                .slider:before {
                                    position: absolute;
                                    content: "";
                                    height: 16px;
                                    width: 16px;
                                    left: 3px;
                                    bottom: 3px;
                                    background-color: white;
                                    transition: .4s;
                                    border-radius: 50%;
                                }

                                input:checked+.slider {
                                    background-color: var(--color-sogang-red);
                                }

                                input:checked+.slider:before {
                                    transform: translateX(18px);
                                }
                            </style>
                        </label>
                    </div>

                    <div class="filter-group">
                        <h4>Project Type</h4>
                        <div id="filter-type" style="display: flex; flex-direction: column; gap: 0.5rem;">
                            <label
                                style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; color: var(--color-text-secondary);">
                                <input type="checkbox" value="Class Project"> Class Project
                            </label>
                            <label
                                style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; color: var(--color-text-secondary);">
                                <input type="checkbox" value="Competition / Hackathon"> Competition / Hackathon
                            </label>
                            <label
                                style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; color: var(--color-text-secondary);">
                                <input type="checkbox" value="Side Project"> Side Project
                            </label>
                            <label
                                style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; color: var(--color-text-secondary);">
                                <input type="checkbox" value="Startup / Pre-startup"> Startup / Pre-startup
                            </label>
                            <label
                                style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; color: var(--color-text-secondary);">
                                <input type="checkbox" value="Club / Study"> Club / Study
                            </label>
                        </div>
                    </div>

                    <div class="filter-group">
                        <h4>Domain</h4>
                        <div id="filter-domain" style="display: flex; flex-direction: column; gap: 0.5rem;">
                            <label
                                style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; color: var(--color-text-secondary);">
                                <input type="checkbox" value="Web / App"> Web / App
                            </label>
                            <label
                                style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; color: var(--color-text-secondary);">
                                <input type="checkbox" value="AI / Data Science"> AI / Data Science
                            </label>
                            <label
                                style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; color: var(--color-text-secondary);">
                                <input type="checkbox" value="Game Development"> Game Development
                            </label>
                            <label
                                style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; color: var(--color-text-secondary);">
                                <input type="checkbox" value="Media Art / Design"> Media Art / Design
                            </label>
                            <label
                                style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; color: var(--color-text-secondary);">
                                <input type="checkbox" value="Hardware / IoT"> Hardware / IoT
                            </label>
                            <label
                                style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; color: var(--color-text-secondary);">
                                <input type="checkbox" value="Fintech / Business"> Fintech / Business
                            </label>
                            <label
                                style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; color: var(--color-text-secondary);">
                                <input type="checkbox" value="Social / Humanities"> Social / Humanities
                            </label>
                            <label
                                style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; color: var(--color-text-secondary);">
                                <input type="checkbox" value="Other"> Other
                            </label>
                        </div>
                    </div>

                    <button id="apply-filters-btn" class="btn btn-secondary"
                        style="width: 100%; font-size: 0.9rem;">Apply Filters</button>
                </div>
            </aside>

            <!-- Grid -->
            <div id="projects-grid" class="projects-grid">
                <!-- Items injected via JS -->
            </div>

        </div>

    </main>

    <footer id="main-footer"></footer>

    <script src="../js/app.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const projects = await window.db.getProjects();
            let filteredProjects = [...projects];

            const grid = document.getElementById('projects-grid');
            const toggle = document.getElementById('sort-toggle');
            const applyBtn = document.getElementById('apply-filters-btn');

            function getCheckedValues(containerId) {
                return Array.from(document.querySelectorAll(`#${containerId} input:checked`)).map(cb => cb.value);
            }

            async function render() {
                grid.innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: var(--color-text-secondary);">Filtering projects...</p>';

                const selectedTypes = getCheckedValues('filter-type');
                const selectedDomains = getCheckedValues('filter-domain');

                // Build filter object for API
                const filters = {};
                if (selectedTypes.length > 0) filters.type = selectedTypes.join(',');
                if (selectedDomains.length > 0) filters.domain = selectedDomains.join(',');

                // Fetch filtered projects from server
                let candidates = await window.db.getProjects(filters);

                // 2. Sort Logic (Client-side for now)
                if (!toggle.checked) {
                    // Recommended OFF: Random Shuffle
                    candidates = candidates.sort(() => Math.random() - 0.5);
                }

                // Render
                grid.innerHTML = candidates.map(p => `
                    <a href="./detail.html?id=${p.id}" class="card" style="text-decoration: none; color: inherit; display: block;">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem;">
                            <span class="badge blue">${p.type || 'Project'}</span>
                            ${toggle.checked ? '<span style="font-size: 0.8rem; font-weight: 600; color: var(--color-sogang-red);">95% Match</span>' : ''}
                        </div>
                        <h3 style="font-size: 1.25rem; margin-bottom: 0.5rem; line-height: 1.4;">${p.title}</h3>
                        <p style="color: var(--color-text-secondary); font-size: 0.95rem; margin-bottom: 1.5rem; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">
                            ${p.oneLineDescription || ''}
                        </p>
                        
                        <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-bottom: 1rem;">
                            ${(p.roles || []).map(r => `
                                <span style="font-size: 0.8rem; background: var(--color-bg-secondary); padding: 2px 8px; border-radius: 4px; color: var(--color-text-secondary);">
                                    ${r.role} (${r.filled || 0}/${r.count})
                                </span>
                            `).join('')}
                        </div>

                        <!-- Team Status Summary -->
                        <div style="margin-bottom: 1rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.25rem;">
                                <span style="font-size: 0.8rem; font-weight: 600; color: var(--color-text-primary);">Team Progress</span>
                                <span style="font-size: 0.8rem; color: var(--color-text-secondary);">
                                    ${(p.members ? p.members.length : 1)} / ${(p.roles || []).reduce((acc, r) => acc + (r.count || 0), 0) + 1}
                                </span>
                            </div>
                            <div style="width: 100%; height: 6px; background: #eee; border-radius: 3px; overflow: hidden;">
                                <div style="height: 100%; background: var(--color-sogang-red); width: ${((p.members ? p.members.length : 1) / ((p.roles || []).reduce((acc, r) => acc + (r.count || 0), 0) + 1)) * 100}%"></div>
                            </div>
                        </div>
                        
                        <div style="border-top: 1px solid var(--color-border); padding-top: 1rem; display: flex; align-items: center; justify-content: space-between;">
                            <span style="font-size: 0.85rem; color: var(--color-text-tertiary);">${p.domain || 'General'}</span>
                            <span style="font-weight: 600; font-size: 0.9rem; color: var(--color-sogang-red);">View &rarr;</span>
                        </div>
                    </a>
                `).join('');

                if (candidates.length === 0) {
                    grid.innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: var(--color-text-secondary); padding: 2rem;">No projects found matching criteria.</p>';
                }
            }

            // Events
            toggle.addEventListener('change', render);
            applyBtn.addEventListener('click', render);

            // Initial Render
            render();

        });
    </script>
</body>

</html>